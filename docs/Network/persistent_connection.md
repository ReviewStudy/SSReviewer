# HTTP 커넥션의 이해

#HTTP #TCP #지연 #커넥션 #성능향상

**요약**: 이 문서는 HTTP 커넥션의 작동 방식과 지연 원인, 성능 향상 기술에 대해 설명합니다. 또한, 지속 커넥션의 장단점과 무중단 배포 시 발생할 수 있는 문제를 다룹니다.

## 브라우저의 URL 처리 과정

1. 브라우저는 URL에서 호스트명을 추출합니다.
2. 해당 호스트의 IP 주소를 찾습니다.
3. 브라우저는 80번 포트를 사용합니다.
4. IP와 포트 번호로 TCP 커넥션을 생성합니다.
5. HTTP GET 요청 메시지를 보냅니다.
6. 응답 메시지를 읽습니다.
7. 커넥션을 종료합니다.

## HTTP 지연의 원인

### 1. TCP 네트워크 지연
- 대부분의 HTTP 지연은 TCP 네트워크 지연에서 발생합니다.
- DNS 조회, TCP 커넥션 요청 및 응답, 데이터 전송 및 처리 시간이 포함됩니다.

### 2. 지연된 ACK
- 작은 크기의 확인응답은 네트워크 효율성을 위해 다른 패킷에 함께 전송됩니다.
- 요청/응답 형식이 적어 지연이 발생할 수 있습니다.

### 3. TCP Slow Start
- 초기에는 커넥션 속도를 제한하고, 데이터 전송 성공에 따라 속도를 높입니다.
- 네이글 알고리즘은 세그먼트가 최대 크기가 되지 않으면 전송을 지연시킵니다.

## Connection 헤더

- `Connection` 헤더는 특정 커넥션에만 적용되는 옵션을 정의합니다.
- Hop-by-Hop 헤더는 다음 커넥션에 전달되지 않습니다.

## HTTP 커넥션 성능 향상 기술

### 병렬 커넥션
- 여러 TCP 커넥션을 동시에 맺어 병렬 처리합니다.
- 여러 요청을 동시에 처리할 수 있지만, 네트워크 대역폭이 좁으면 효과가 적습니다.

### 지속 커넥션
- HTTP 요청 후에도 TCP 연결을 유지하여 추가 요청을 처리합니다.
- 연결 비용을 줄일 수 있지만, 잘못 관리되면 불필요한 커넥션이 유지될 수 있습니다.

## HTTP Keep Alive

- HTTP/1.0+부터 지원하는 지속 커넥션 기법입니다.
- 서버가 지원하면 `Keep-Alive` 헤더를 통해 커넥션을 유지합니다.

## HTTP 1.1의 지속 커넥션

- 기본적으로 활성화되어 있으며, `Connection: close` 헤더가 없으면 커넥션을 유지합니다.
- 파이프라인 커넥션을 통해 요청을 순서대로 처리합니다.

## 커넥션 끊기

- 지속 커넥션이 유휴 상태일 때 서버는 커넥션을 끊을 수 있습니다.
- 멱등한 요청은 반복해도 문제가 없지만, 비멱등한 요청은 주의해야 합니다.

## 무중단 배포 시 지속 커넥션 문제

1. 서버 종료 시 지속 커넥션이 남아 있을 수 있습니다.
2. 로드 밸런서가 새로운 서버로 트래픽을 보내지 못할 수 있습니다.
3. 클라이언트가 새로운 서버로 자동 연결되지 않을 수 있습니다.

### 해결 방안
- 로드 밸런서의 Connection Draining 사용
- Graceful Shutdown 구현
- Kubernetes의 terminationGracePeriodSeconds 설정

## 주요 포인트

- HTTP 커넥션의 작동 방식과 지연 원인
- 병렬 및 지속 커넥션의 장단점
- HTTP Keep Alive와 HTTP 1.1의 지속 커넥션
- 무중단 배포 시 지속 커넥션 문제와 해결 방안

## 토론 및 질문

1. HTTP 지연을 줄이기 위한 다른 방법은 무엇이 있을까요?
2. 병렬 커넥션과 지속 커넥션 중 어떤 상황에서 더 유리할까요?
3. HTTP 1.1의 지속 커넥션이 HTTP 1.0보다 나은 점은 무엇인가요?
4. 무중단 배포 시 지속 커넥션 문제를 해결하기 위한 다른 전략은 무엇일까요?
5. 멱등한 요청과 비멱등한 요청의 차이점은 무엇인가요?